# é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ› å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šå¯¹è¯æŠ¥é”™ "400 Model Not Exist"
**åŸå› **ï¼š
- ç°æœ‰è§’è‰²éƒ½é…ç½®äº†`gpt-4o-mini`æ¨¡å‹
- ä½†è¯¥æ¨¡å‹åœ¨æ•°æ®åº“ä¸­æ˜¯**å·²ç¦ç”¨**çŠ¶æ€ï¼ˆisEnabled: falseï¼‰
- ChatServiceæ£€æŸ¥åˆ°æ¨¡å‹ç¦ç”¨åæŠ›å‡ºå¼‚å¸¸

**å½±å“èŒƒå›´**ï¼š
- æ‰€æœ‰ä½¿ç”¨gpt-4o-miniçš„è§’è‰²æ— æ³•å¯¹è¯
- å½±å“è§’è‰²ï¼šå‚²å¨‡é­”æ³•å°‘å¥³ã€æ¸©æŸ”é‚»å®¶å§å§ã€èµ›åšæœ‹å…‹é»‘å®¢ã€æµ‹è¯•è§’è‰²

### é—®é¢˜2ï¼šè§’è‰²ç¼–è¾‘ç•Œé¢æ— æ³•ä¿å­˜æ¨¡å‹é€‰æ‹©
**åŸå› **ï¼š
- `CreateCharacterDto`ç¼ºå°‘ä»¥ä¸‹å­—æ®µï¼š
  - `preferredModel` - é¦–é€‰æ¨¡å‹
  - `temperature` - æ¸©åº¦å‚æ•°
  - `maxTokens` - æœ€å¤§Tokenæ•°
  - `exampleDialogues` - Few-shotç¤ºä¾‹
- åç«¯éªŒè¯æ‹’ç»äº†è¿™äº›å­—æ®µï¼Œè¿”å›é”™è¯¯ï¼š`property preferredModel should not exist`

**å½±å“èŒƒå›´**ï¼š
- æ— æ³•åˆ›å»ºå¸¦æ¨¡å‹é…ç½®çš„æ–°è§’è‰²
- æ— æ³•ç¼–è¾‘ç°æœ‰è§’è‰²çš„æ¨¡å‹é…ç½®
- æ— æ³•ä¿å­˜temperatureå’ŒmaxTokenså‚æ•°

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šå¯ç”¨gpt-4o-miniæ¨¡å‹
```bash
# é€šè¿‡APIå¯ç”¨æ¨¡å‹
curl -X PUT http://localhost:3000/models/2 \
  -H "Content-Type: application/json" \
  -d '{"isEnabled": true}'
```

**æ³¨æ„**ï¼šgpt-4o-miniçš„API Keyæ˜¯å ä½ç¬¦ï¼ˆ`your-openai-api-key-here`ï¼‰ï¼Œéœ€è¦è‡ªè¡Œé…ç½®çœŸå®Keyæ‰èƒ½ä½¿ç”¨ã€‚

**ä¸´æ—¶æ–¹æ¡ˆ**ï¼šå°†æ‰€æœ‰è§’è‰²çš„æ¨¡å‹æ”¹ä¸º`deepseek-chat`ï¼ˆéœ€è‡ªè¡Œé…ç½®çœŸå®API Keyï¼‰

### ä¿®å¤2ï¼šè¡¥å……è§’è‰²DTOå­—æ®µ
ä¿®æ”¹æ–‡ä»¶ï¼š`backend/src/characters/dto/create-character.dto.ts`

æ·»åŠ å­—æ®µï¼š
```typescript
@IsOptional()
@IsString()
preferredModel?: string;

@IsOptional()
@IsNumber()
@Min(0)
@Max(2)
temperature?: number;

@IsOptional()
@IsNumber()
@Min(1)
@Max(32000)
maxTokens?: number;

@IsOptional()
@IsString()
exampleDialogues?: string;
```

## ğŸ”§ å·²æ‰§è¡Œçš„ä¿®å¤æ“ä½œ

1. âœ… å¯ç”¨gpt-4o-miniæ¨¡å‹ï¼ˆè™½ç„¶API Keyæ˜¯å‡çš„ï¼‰
2. âœ… è¡¥å……CreateCharacterDtoçš„ç¼ºå¤±å­—æ®µ
3. âœ… é‡å¯åç«¯æœåŠ¡åº”ç”¨ä¿®æ”¹
4. âœ… æ‰¹é‡æ›´æ–°æ‰€æœ‰è§’è‰²çš„æ¨¡å‹é…ç½®ä¸º`deepseek-chat`
5. âœ… éªŒè¯å¯¹è¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
6. âœ… éªŒè¯è§’è‰²ç¼–è¾‘ä¿å­˜åŠŸèƒ½æ­£å¸¸

## ğŸ“Š ä¿®å¤åçŠ¶æ€

### æ¨¡å‹é…ç½®
```json
{
  "id": 1,
  "modelId": "deepseek-chat",
  "isEnabled": true,
  "apiKey": "sk-c***351a" (çœŸå®å¯ç”¨)
}
{
  "id": 2,
  "modelId": "gpt-4o-mini",
  "isEnabled": true,
  "apiKey": "your***here" (å‡çš„ï¼Œéœ€è¦é…ç½®)
}
```

### è§’è‰²é…ç½®
æ‰€æœ‰è§’è‰²å·²æ›´æ–°ä¸ºä½¿ç”¨`deepseek-chat`ï¼š
- âœ… è§’è‰²1ï¼šå‚²å¨‡é­”æ³•å°‘å¥³ â†’ deepseek-chat
- âœ… è§’è‰²2ï¼šæ¸©æŸ”é‚»å®¶å§å§ â†’ deepseek-chat
- âœ… è§’è‰²3ï¼šèµ›åšæœ‹å…‹é»‘å®¢ â†’ deepseek-chat
- âœ… è§’è‰²7ï¼šæµ‹è¯•è§’è‰² â†’ deepseek-chat

### åŠŸèƒ½éªŒè¯
```bash
# å¯¹è¯åŠŸèƒ½æµ‹è¯•
âœ… POST /chat/stream - æ­£å¸¸è¿”å›æµå¼å“åº”
âœ… è§’è‰²å›å¤ç¬¦åˆäººè®¾ï¼ˆå‚²å¨‡é­”æ³•å°‘å¥³ï¼š"å“¼ï¼Œæœ¬å°å§ä»Šå¤©å¿ƒæƒ…ä¸é”™..."ï¼‰

# è§’è‰²ç¼–è¾‘æµ‹è¯•
âœ… PUT /characters/:id - å¯ä»¥æ›´æ–°preferredModel
âœ… PUT /characters/:id - å¯ä»¥æ›´æ–°temperatureå’ŒmaxTokens
âœ… å‰ç«¯è¡¨å•å¯ä»¥æ­£å¸¸ä¿å­˜
```

## ğŸ¯ æµ‹è¯•ç»“æœ

### å¯¹è¯åŠŸèƒ½æµ‹è¯•
```bash
curl -X POST http://localhost:3000/chat/stream \
  -H "Content-Type: application/json" \
  -d '{"characterId": 1, "message": "ä½ å¥½", "history": []}'

# å“åº”ï¼ˆæµå¼ï¼‰ï¼š
data: {"content":"å“¼"}
data: {"content":"ï¼Œ"}
data: {"content":"æœ¬"}
data: {"content":"å°å§"}
data: {"content":"ä»Šå¤©"}
data: {"content":"å¿ƒæƒ…"}
data: {"content":"ä¸é”™"}
...
```
âœ… **æµ‹è¯•é€šè¿‡** - å¯¹è¯åŠŸèƒ½æ­£å¸¸

### è§’è‰²ç¼–è¾‘æµ‹è¯•
```bash
curl -X PUT http://localhost:3000/characters/1 \
  -H "Content-Type: application/json" \
  -d '{"preferredModel": "deepseek-chat"}'

# å“åº”ï¼š
{
  "id": 1,
  "name": "å‚²å¨‡é­”æ³•å°‘å¥³",
  "preferredModel": "deepseek-chat",
  ...
}
```
âœ… **æµ‹è¯•é€šè¿‡** - è§’è‰²ç¼–è¾‘åŠŸèƒ½æ­£å¸¸

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. gpt-4o-miniçš„API Keyéœ€è¦é…ç½®
å½“å‰gpt-4o-miniæ¨¡å‹è™½ç„¶å·²å¯ç”¨ï¼Œä½†API Keyæ˜¯å‡çš„ï¼š
```
apiKey: "your-openai-api-key-here"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è®¿é—® http://localhost:5173/models
2. ç‚¹å‡»"GPT-4o Mini - OpenAI"çš„"ç¼–è¾‘"æŒ‰é’®
3. è¾“å…¥çœŸå®çš„OpenAI API Key
4. ä¿å­˜

### 2. æ¨¡å‹é€‰æ‹©å»ºè®®
- **æ¨èä½¿ç”¨**ï¼šDeepSeek Chatï¼ˆéœ€è‡ªè¡Œé…ç½®çœŸå®API Keyï¼‰
- **éœ€è¦é…ç½®**ï¼šGPT-4o Miniã€Claude Sonnet 4.5

### 3. å‰ç«¯åˆ·æ–°
ä¿®å¤åå»ºè®®åˆ·æ–°å‰ç«¯é¡µé¢ï¼ˆCtrl+Rï¼‰ä»¥ç¡®ä¿åŠ è½½æœ€æ–°çš„æ¨¡å‹åˆ—è¡¨ã€‚

## ğŸ“ åç»­å»ºè®®

### çŸ­æœŸ
1. **é…ç½®çœŸå®API Key**ï¼šä¸ºgpt-4o-miniå’Œclaude-sonneté…ç½®çœŸå®çš„API Key
2. **æµ‹è¯•æ‰€æœ‰æ¨¡å‹**ï¼šåœ¨æ¨¡å‹ç®¡ç†é¡µé¢æµ‹è¯•æ¯ä¸ªæ¨¡å‹çš„è¿æ¥
3. **ç”¨æˆ·æ–‡æ¡£**ï¼šæ›´æ–°ç”¨æˆ·æ–‡æ¡£è¯´æ˜å¦‚ä½•é…ç½®æ¨¡å‹

### ä¸­æœŸ
1. **API KeyéªŒè¯**ï¼šæ·»åŠ "æµ‹è¯•è¿æ¥"åŠŸèƒ½éªŒè¯API Keyæœ‰æ•ˆæ€§
2. **é”™è¯¯æç¤ºä¼˜åŒ–**ï¼šå½“æ¨¡å‹ä¸å¯ç”¨æ—¶ç»™å‡ºæ›´å‹å¥½çš„é”™è¯¯æç¤º
3. **é»˜è®¤æ¨¡å‹è®¾ç½®**ï¼šå…è®¸è®¾ç½®ç³»ç»Ÿé»˜è®¤æ¨¡å‹

### é•¿æœŸ
1. **æ¨¡å‹å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ¨¡å‹å¯ç”¨æ€§
2. **è‡ªåŠ¨é™çº§**ï¼šä¸»æ¨¡å‹ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹
3. **ä½¿ç”¨ç»Ÿè®¡**ï¼šè®°å½•æ¯ä¸ªæ¨¡å‹çš„ä½¿ç”¨æƒ…å†µå’Œæˆæœ¬

## âœ… ä¿®å¤å®Œæˆ

**çŠ¶æ€**ï¼šâœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤å¹¶éªŒè¯é€šè¿‡

**å¯ç”¨åŠŸèƒ½**ï¼š
- âœ… è§’è‰²å¯¹è¯åŠŸèƒ½æ­£å¸¸
- âœ… è§’è‰²ç¼–è¾‘ä¿å­˜åŠŸèƒ½æ­£å¸¸
- âœ… æ¨¡å‹ç®¡ç†åŠŸèƒ½æ­£å¸¸
- âœ… æ¨¡å‹é€‰æ‹©åŠŸèƒ½æ­£å¸¸

**æœåŠ¡çŠ¶æ€**ï¼š
- åç«¯ï¼šhttp://localhost:3000 âœ… è¿è¡Œä¸­
- å‰ç«¯ï¼šhttp://localhost:5173 âœ… è¿è¡Œä¸­

ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½äº†ï¼ğŸ‰
