# 会话管理侧边栏功能测试指南

## 功能概述
在对话页面添加了"历史会话"按钮，点击展开侧边栏显示当前角色的所有会话，支持快速切换、新建、删除等操作。

## 已实现的功能

### 1. 新增组件
- ✅ `Drawer.vue` - 通用抽屉组件，支持左/右侧滑入
- ✅ `SessionSidebar.vue` - 会话侧边栏组件

### 2. Chat.vue 修改
- ✅ 添加"历史会话"按钮（📋图标）
- ✅ 集成Drawer和SessionSidebar组件
- ✅ 实现会话切换逻辑
- ✅ 实现新建会话逻辑

## 测试步骤

### 准备工作
1. 确保前后端服务器都在运行
   - 前端: http://localhost:5174/
   - 后端: http://localhost:3000/

2. 确保数据库中有角色数据和会话数据

### 功能测试

#### 1. 打开侧边栏
1. 进入任意角色的对话页面
2. 点击右上角的"📋"按钮
3. **预期结果**：
   - 侧边栏从右侧滑入
   - 显示半透明黑色遮罩层
   - 侧边栏显示当前角色的名称

#### 2. 查看会话列表
1. 侧边栏打开后
2. **预期结果**：
   - 显示当前角色的所有会话
   - 当前会话有红色边框高亮
   - 每个会话显示：
     - 最后消息预览
     - 消息数量
     - 更新时间（刚刚/X分钟前/X小时前/X天前）
   - 会话按时间倒序排列

#### 3. 切换会话
1. 点击列表中的其他会话
2. **预期结果**：
   - 页面加载该会话的历史记录
   - URL的query参数更新为新的sessionKey
   - 侧边栏自动关闭
   - 消息列表滚动到底部

#### 4. 新建会话
1. 点击"➕ 新建会话"按钮
2. **预期结果**：
   - 创建新会话并清空消息
   - 显示角色的greeting消息
   - URL更新为新的sessionKey
   - 侧边栏自动关闭

#### 5. 删除会话
1. 点击会话项的"🗑️"按钮
2. **预期结果**：
   - 弹出ConfirmDialog确认对话框
   - 显示"确定要删除这个会话吗？此操作不可恢复！"
3. 点击"确认"
4. **预期结果**：
   - 会话被删除
   - 列表刷新，删除的会话消失
   - 如果删除的是当前会话，自动创建新会话

#### 6. 导出会话
1. 点击会话项的"📥"按钮
2. **预期结果**：
   - 下载JSON文件
   - 文件名格式：`session-{sessionKey}.json`

#### 7. 关闭侧边栏
1. 点击遮罩层或右上角的"✕"按钮
2. **预期结果**：
   - 侧边栏滑出并关闭
   - 遮罩层消失

#### 8. 加载更多会话
1. 如果会话数量超过20条
2. 滚动到列表底部
3. 点击"加载更多"按钮
4. **预期结果**：
   - 加载下一页会话
   - 新会话追加到列表末尾

### 边界测试

#### 1. 空状态
1. 创建一个新角色（没有历史会话）
2. 进入对话页面，点击"历史会话"按钮
3. **预期结果**：
   - 显示"暂无会话记录"提示

#### 2. 删除当前会话
1. 在对话页面中，打开侧边栏
2. 删除当前正在使用的会话
3. **预期结果**：
   - 自动创建新会话
   - 显示角色的greeting消息
   - 不会出现空白状态

#### 3. 快速切换
1. 快速点击多个不同的会话
2. **预期结果**：
   - 不会出现状态混乱
   - 最终显示最后点击的会话

### 样式测试

#### 1. 动画效果
- 侧边栏滑入/滑出动画流畅
- 遮罩层淡入/淡出效果
- 会话项hover效果

#### 2. 响应式设计
- 侧边栏宽度：360px
- 在小屏幕上测试（可以调整浏览器窗口大小）

#### 3. 当前会话高亮
- 当前会话有红色边框
- 背景色为淡红色渐变

## 已知问题和改进建议

### 当前实施的限制
1. 侧边栏宽度固定为360px，在移动端可能需要调整为90vw
2. 没有实现ESC键关闭侧边栏（可选功能）
3. 没有实现触摸滑动关闭（可选功能）
4. 没有防止body滚动穿透（侧边栏打开时body仍可滚动）

### 后续优化方向
1. 添加虚拟滚动支持大量会话
2. 添加会话搜索功能
3. 添加会话分组（按日期）
4. 添加会话重命名功能
5. 优化移动端体验

## 技术实现细节

### 组件结构
```
Chat.vue
├── Drawer.vue (通用抽屉组件)
│   └── SessionSidebar.vue (会话侧边栏)
│       └── ConfirmDialog.vue (删除确认对话框)
```

### 关键API
- `getSessions(characterId, page, limit)` - 获取会话列表
- `deleteSession(sessionKey)` - 删除会话
- `exportSession(sessionKey)` - 导出会话

### 状态管理
- `showSessionSidebar` - 控制侧边栏显示/隐藏
- `sessions` - 会话列表数据
- `currentSessionKey` - 当前会话Key（用于高亮）

### URL参数
- `sessionKey` - 会话Key，用于加载指定会话

## 测试清单

- [ ] 打开侧边栏
- [ ] 显示会话列表
- [ ] 当前会话高亮
- [ ] 切换会话
- [ ] 新建会话
- [ ] 删除会话（非当前）
- [ ] 删除会话（当前）
- [ ] 导出会话
- [ ] 关闭侧边栏（点击遮罩）
- [ ] 关闭侧边栏（点击✕按钮）
- [ ] 加载更多会话
- [ ] 空状态显示
- [ ] 动画效果流畅
- [ ] 样式正确显示

## 访问地址
- 前端: http://localhost:5174/
- 后端: http://localhost:3000/

开始测试吧！🚀

